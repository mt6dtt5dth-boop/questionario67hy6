<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio Profissional - Newdri Clinic</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @media print {
            body {
                background: white;
            }
            .no-print {
                display: none !important;
            }
            .page-break {
                page-break-after: always;
            }
            @page {
                size: A4;
                margin: 2cm;
            }
        }

        .relatorio-a4 {
            background: white;
            max-width: 210mm;
            margin: 0 auto;
            padding: 20mm;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .header-relatorio {
            border-bottom: 4px solid #6a4c93;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .secao-relatorio {
            margin-bottom: 40px;
        }

        .secao-relatorio h2 {
            color: #6a4c93;
            border-left: 5px solid #6a4c93;
            padding-left: 15px;
            margin-bottom: 20px;
        }

        .escala-visual {
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f4fc 0%, #fff 100%);
            border-radius: 10px;
            border-left: 5px solid #6a4c93;
        }

        .badge-perfil {
            display: inline-block;
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 1.2rem;
            margin: 10px 5px;
        }

        .badge-dominante { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
        .badge-submisso { background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; }
        .badge-switch { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
        .badge-explorador { background: linear-gradient(135deg, #f39c12, #e67e22); color: white; }
        .badge-romantico { background: linear-gradient(135deg, #e91e63, #c2185b); color: white; }
        .badge-conservador { background: linear-gradient(135deg, #95a5a6, #7f8c8d); color: white; }

        .grafico-container {
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .info-demografica {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .info-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #6a4c93;
        }

        .info-item strong {
            color: #6a4c93;
            display: block;
            margin-bottom: 5px;
        }

        .alert-critico {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            border-left: 5px solid #f44336;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .recomendacao-box {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-left: 5px solid #4caf50;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .marcador-list {
            list-style: none;
            padding: 0;
        }

        .marcador-list li {
            padding: 10px;
            margin: 8px 0;
            background: #f8f4fc;
            border-radius: 5px;
            border-left: 3px solid #6a4c93;
        }

        .marcador-list li::before {
            content: "‚úì";
            color: #4caf50;
            font-weight: bold;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="no-print" style="position: fixed; top: 20px; right: 20px; z-index: 1000;">
        <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Imprimir / Salvar PDF</button>
        <button class="btn btn-secondary" onclick="window.close()">‚úï Fechar</button>
    </div>

    <div class="relatorio-a4">
        <!-- CABE√áALHO -->
        <div class="header-relatorio">
            <h1 style="color: #6a4c93; margin: 0; font-size: 2rem;">üå∏ Newdri Clinic</h1>
            <p style="color: #7f8c8d; margin: 5px 0 0 0;">S√£o Louren√ßo - MG</p>
            <h2 style="margin: 20px 0 10px 0;">Relat√≥rio de Avalia√ß√£o Psicossexual</h2>
            <p style="color: #7f8c8d;"><strong>Dr. Newton Guimar√£es</strong> | Psicanalista</p>
            <p style="color: #999; font-size: 0.9rem;">
                <strong>C√≥digo:</strong> <span id="codigoRelatorio">-</span> | 
                <strong>Data:</strong> <span id="dataRelatorio">-</span>
            </p>
        </div>

        <div id="conteudoRelatorioCompleto">
            <div style="text-align: center; padding: 100px 20px;">
                <div class="loading"></div>
                <p style="margin-top: 20px; color: #7f8c8d;">Gerando relat√≥rio detalhado...</p>
            </div>
        </div>
    </div>

    <script src="js/supabase-config.js"></script>
    <script src="js/analise.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const codigo = localStorage.getItem('relatorio_codigo');
            
            if (!codigo) {
                alert('C√≥digo n√£o encontrado');
                window.close();
                return;
            }

            document.getElementById('codigoRelatorio').textContent = codigo;

            // Inicializar Supabase
            initSupabase();

            // Buscar dados
            const resultado = await buscarRespostas(codigo);

            if (!resultado.sucesso) {
                document.getElementById('conteudoRelatorioCompleto').innerHTML = 
                    '<div class="alert alert-danger">Erro ao carregar dados: ' + resultado.erro + '</div>';
                return;
            }

            const dados = {
                demograficos: resultado.dados.dados_demograficos,
                respostas: resultado.dados.respostas,
                timestamp: resultado.dados.respondido_em
            };

            document.getElementById('dataRelatorio').textContent = 
                new Date(dados.timestamp).toLocaleString('pt-BR');

            // Realizar an√°lise
            const analise = analisarQuestionario(dados);

            // Renderizar relat√≥rio completo
            renderizarRelatorioCompleto(dados, analise);
        });

        function renderizarRelatorioCompleto(dados, analise) {
            const container = document.getElementById('conteudoRelatorioCompleto');

            let html = `
                <!-- SE√á√ÉO 1: DADOS DEMOGR√ÅFICOS -->
                <div class="secao-relatorio">
                    <h2>I. Perfil Demogr√°fico e Contextual</h2>
                    <div class="info-demografica">
                        <div class="info-item">
                            <strong>Nome</strong>
                            ${dados.demograficos.nome || 'An√¥nimo'}
                        </div>
                        <div class="info-item">
                            <strong>Idade</strong>
                            ${dados.demograficos.idade} anos
                        </div>
                        <div class="info-item">
                            <strong>Estado Civil</strong>
                            ${formatarEstadoCivil(dados.demograficos.estadoCivil)}
                        </div>
                        <div class="info-item">
                            <strong>Localidade</strong>
                            ${dados.demograficos.cidade} (${formatarLocalidade(dados.demograficos.tipoLocalidade)})
                        </div>
                        <div class="info-item">
                            <strong>Profiss√£o</strong>
                            ${dados.demograficos.profissao}
                        </div>
                        <div class="info-item">
                            <strong>Escolaridade</strong>
                            ${formatarEscolaridade(dados.demograficos.escolaridade)}
                        </div>
                    </div>
                </div>

                <div class="page-break"></div>

                <!-- SE√á√ÉO 2: PERFIL PSICOSSEXUAL -->
                <div class="secao-relatorio">
                    <h2>II. Perfil Psicossexual Identificado</h2>
                    
                    <div style="text-align: center; margin: 30px 0;">
                        <span class="badge-perfil ${getBadgeClass(analise.perfil.principal)}">
                            ${analise.perfil.principal.toUpperCase()}
                        </span>
                        ${analise.perfil.subtipo ? `
                            <span class="badge-perfil" style="background: linear-gradient(135deg, #c991cc, #b08cc9);">
                                ${analise.perfil.subtipo}
                            </span>
                        ` : ''}
                    </div>

                    ${analise.perfil.secundario ? `
                        <p style="text-align: center; color: #7f8c8d;">
                            <strong>Perfil Secund√°rio:</strong> ${analise.perfil.secundario}
                        </p>
                    ` : ''}

                    <div class="escala-visual">
                        <p><strong>Confian√ßa do Perfil:</strong> ${analise.perfil.confianca}%</p>
                        <div style="background: #e0e0e0; height: 30px; border-radius: 15px; overflow: hidden; margin-top: 10px;">
                            <div style="background: linear-gradient(135deg, #4caf50, #8bc34a); 
                                        width: ${analise.perfil.confianca}%; height: 100%; 
                                        display: flex; align-items: center; justify-content: center;
                                        color: white; font-weight: 700;">
                                ${analise.perfil.confianca}%
                            </div>
                        </div>
                    </div>

                    <h3 style="color: #6a4c93; margin-top: 30px;">Marcadores Identificados:</h3>
                    <ul class="marcador-list">
                        ${analise.perfil.marcadores && analise.perfil.marcadores.length > 0 
                            ? analise.perfil.marcadores.map(m => `<li>${m}</li>`).join('')
                            : '<li>Perfil em desenvolvimento ou vers√°til</li>'
                        }
                    </ul>
                </div>

                <!-- SE√á√ÉO 3: ESCALAS PSICOM√âTRICAS -->
                <div class="secao-relatorio">
                    <h2>III. Escalas Psicom√©tricas</h2>
                    
                    <div class="grafico-container">
                        <canvas id="graficoEscalas" width="400" height="300"></canvas>
                    </div>

                    <h3 style="color: #6a4c93; margin-top: 30px;">Interpreta√ß√£o Detalhada:</h3>

                    ${renderizarEscalaDetalhada('Abertura Sexual', analise.escalas.aberturaSexual, 100)}
                    ${renderizarEscalaDetalhada('Autoconhecimento', analise.escalas.autoconhecimento, 100)}
                    ${renderizarEscalaDetalhada('Domin√¢ncia ‚Üî Submiss√£o', analise.escalas.dominanciaSubmissao, 50, true)}
                    ${renderizarEscalaDetalhada('Masoquismo', analise.escalas.masoquismo, 100)}
                    ${renderizarEscalaDetalhada('Disson√¢ncia Contexto/Desejo', analise.escalas.dissonanciaContexto, 100, false, true)}
                </div>

                <div class="page-break"></div>

                <!-- SE√á√ÉO 4: AN√ÅLISE CONTEXTUAL -->
                <div class="secao-relatorio">
                    <h2>IV. An√°lise Contextual Sociodemogr√°fica</h2>
                    
                    ${renderizarContexto(analise.contexto)}
                </div>

                <!-- SE√á√ÉO 5: DISSON√ÇNCIAS -->
                <div class="secao-relatorio">
                    <h2>V. An√°lise de Disson√¢ncias e Inconsist√™ncias</h2>
                    
                    ${renderizarDissonancias(analise)}
                </div>

                <div class="page-break"></div>

                <!-- SE√á√ÉO 6: RECOMENDA√á√ïES -->
                <div class="secao-relatorio">
                    <h2>VI. Recomenda√ß√µes Terap√™uticas</h2>
                    
                    ${renderizarRecomendacoes(analise.recomendacoes)}
                </div>

                <!-- RODAP√â -->
                <div style="margin-top: 60px; padding-top: 30px; border-top: 2px solid #e0e0e0; text-align: center; color: #7f8c8d;">
                    <p><strong>Dr. Newton Guimar√£es</strong></p>
                    <p>Psicanalista - Newdri Clinic</p>
                    <p style="font-size: 0.9rem; margin-top: 20px;">
                        <em>Este relat√≥rio foi gerado por sistema computadorizado de avalia√ß√£o psicom√©trica.<br>
                        Os resultados devem ser interpretados por profissional qualificado em contexto terap√™utico.</em>
                    </p>
                    <p style="font-size: 0.85rem; margin-top: 10px;">
                        <strong>Confidencial - Uso Profissional Exclusivo</strong>
                    </p>
                </div>
            `;

            container.innerHTML = html;

            // Criar gr√°ficos
            criarGraficos(analise);
        }

        function criarGraficos(analise) {
            // Gr√°fico de Radar - Escalas
            const ctx = document.getElementById('graficoEscalas');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: [
                        'Abertura Sexual',
                        'Autoconhecimento',
                        'Dom/Sub',
                        'Masoquismo',
                        'Disson√¢ncia'
                    ],
                    datasets: [{
                        label: 'Pontua√ß√£o',
                        data: [
                            analise.escalas.aberturaSexual,
                            analise.escalas.autoconhecimento,
                            Math.abs(analise.escalas.dominanciaSubmissao),
                            analise.escalas.masoquismo,
                            100 - analise.escalas.dissonanciaContexto // Inverter para positivo
                        ],
                        backgroundColor: 'rgba(106, 76, 147, 0.2)',
                        borderColor: 'rgba(106, 76, 147, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(106, 76, 147, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(106, 76, 147, 1)'
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function renderizarEscalaDetalhada(nome, valor, max, bipolar = false, critico = false) {
            const porcentagem = bipolar ? Math.abs(valor) / max * 100 : valor / max * 100;
            const cor = critico 
                ? (valor > 70 ? '#f44336' : valor > 40 ? '#ff9800' : '#4caf50')
                : (porcentagem > 70 ? '#4caf50' : porcentagem > 40 ? '#ff9800' : '#f44336');

            const interpretacao = interpretarEscala(nome, valor, bipolar);

            return `
                <div class="escala-visual">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <strong>${nome}</strong>
                        <span style="color: ${cor}; font-weight: 700; font-size: 1.2rem;">
                            ${bipolar ? (valor > 0 ? '+' : '') : ''}${valor}${bipolar ? '' : '%'}
                        </span>
                    </div>
                    <div style="background: #e0e0e0; height: 25px; border-radius: 12px; overflow: hidden;">
                        <div style="background: ${cor}; width: ${porcentagem}%; height: 100%; 
                                    transition: width 0.3s ease;"></div>
                    </div>
                    <p style="margin-top: 10px; color: #7f8c8d; font-size: 0.95rem;">
                        ${interpretacao}
                    </p>
                </div>
            `;
        }

        function interpretarEscala(nome, valor, bipolar) {
            if (nome === 'Abertura Sexual') {
                if (valor > 70) return '‚úÖ Alta abertura para novas experi√™ncias. Curiosidade e explora√ß√£o ativa.';
                if (valor > 40) return '‚ö†Ô∏è Abertura moderada. Depende de contexto e confian√ßa no parceiro.';
                return '‚ö†Ô∏è Baixa abertura. Prefer√™ncia por familiar ou poss√≠vel repress√£o contextual.';
            }
            if (nome === 'Autoconhecimento') {
                if (valor > 70) return '‚úÖ Excelente conhecimento de si mesma e de seus desejos.';
                if (valor > 40) return '‚ö†Ô∏è Conhecimento moderado. Ainda em processo de descoberta.';
                return '‚ö†Ô∏è Baixo autoconhecimento. Recomenda-se trabalho de explora√ß√£o pessoal.';
            }
            if (nome === 'Domin√¢ncia ‚Üî Submiss√£o') {
                if (valor > 20) return 'üî¥ Tend√™ncia dominante pronunciada. Desejo de lideran√ßa e controle.';
                if (valor < -20) return 'üü£ Tend√™ncia submissa pronunciada. Desejo de entrega e prote√ß√£o.';
                return 'üîµ Perfil vers√°til/switch. Altern√¢ncia entre pap√©is conforme contexto.';
            }
            if (nome === 'Masoquismo') {
                if (valor > 60) return '‚ö†Ô∏è Alto interesse em sensa√ß√µes intensas e leve dor consensual.';
                if (valor > 30) return '‚ö†Ô∏è Interesse moderado. Curiosidade presente mas n√£o explorada.';
                return '‚úÖ Baixo interesse ou n√£o explorado. Prefer√™ncia por sensa√ß√µes suaves.';
            }
            if (nome === 'Disson√¢ncia Contexto/Desejo') {
                if (valor > 70) return 'üö® SEVERA - Diferen√ßa cr√≠tica entre desejos e express√£o. Interven√ß√£o urgente.';
                if (valor > 40) return '‚ö†Ô∏è MODERADA - Repress√£o presente. Trabalho terap√™utico recomendado.';
                return '‚úÖ BAIXA - Boa congru√™ncia entre desejos internos e express√£o externa.';
            }
            return '';
        }

        function renderizarContexto(contexto) {
            return `
                <h3 style="color: #6a4c93;">An√°lise por Localidade:</h3>
                <div class="info-item">
                    <strong>Tipo de Localidade:</strong> ${contexto.localidade.tipo}<br>
                    <strong>Press√£o Social:</strong> ${contexto.localidade.pressaoSocial}
                    ${contexto.localidade.ajustes.length > 0 ? `
                        <ul style="margin-top: 10px;">
                            ${contexto.localidade.ajustes.map(a => `<li>${a}</li>`).join('')}
                        </ul>
                    ` : ''}
                </div>

                <h3 style="color: #6a4c93; margin-top: 20px;">An√°lise por Faixa Et√°ria:</h3>
                <div class="info-item">
                    <strong>Faixa:</strong> ${contexto.idade.faixa}<br>
                    <strong>Caracter√≠sticas:</strong> ${contexto.idade.caracteristicas.join(', ')}
                    ${contexto.idade.observacoes.length > 0 ? `
                        <div class="alert-critico" style="margin-top: 15px;">
                            ${contexto.idade.observacoes.map(o => `<p>‚ö†Ô∏è ${o}</p>`).join('')}
                        </div>
                    ` : ''}
                </div>

                <h3 style="color: #6a4c93; margin-top: 20px;">Din√¢mica Relacional:</h3>
                <div class="info-item">
                    <strong>Status:</strong> ${contexto.estadoCivil.status}
                    ${contexto.estadoCivil.dinamica ? `<br><strong>Din√¢mica:</strong> ${contexto.estadoCivil.dinamica}` : ''}
                    ${contexto.estadoCivil.alertas.length > 0 ? `
                        <div class="alert-critico" style="margin-top: 15px;">
                            ${contexto.estadoCivil.alertas.map(a => `<p>‚ö†Ô∏è ${a}</p>`).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderizarDissonancias(analise) {
            const analisador = new AnalisadorPsicossexual(
                JSON.parse(localStorage.getItem('questionario_dados') || '{}')
            );
            const dissonancias = analisador.detectarDissonancias();

            if (dissonancias.length === 0) {
                return `
                    <div style="background: linear-gradient(135deg, #e8f5e9, #c8e6c9); 
                                padding: 30px; border-radius: 10px; border-left: 5px solid #4caf50;">
                        <h3 style="color: #4caf50; margin-top: 0;">‚úÖ Consist√™ncia Alta</h3>
                        <p>N√£o foram detectadas inconsist√™ncias significativas entre as respostas. 
                        Isso indica boa congru√™ncia entre desejos, fantasias e comportamentos.</p>
                    </div>
                `;
            }

            const criticas = dissonancias.filter(d => d.criticidade === 'ALTA');
            const outras = dissonancias.filter(d => d.criticidade !== 'ALTA');

            let html = '';

            if (criticas.length > 0) {
                html += '<h3 style="color: #f44336;">üö® Disson√¢ncias Cr√≠ticas:</h3>';
                criticas.forEach(d => {
                    html += `
                        <div class="alert-critico">
                            <h4 style="color: #f44336; margin-top: 0;">${d.tipo}</h4>
                            <p><strong>Par de Quest√µes:</strong> ${d.par}</p>
                            <p><strong>Descri√ß√£o:</strong> ${d.descricao}</p>
                            <p><strong>Interpreta√ß√£o:</strong> ${d.interpretacao}</p>
                        </div>
                    `;
                });
            }

            if (outras.length > 0) {
                html += '<h3 style="color: #ff9800; margin-top: 30px;">‚ö†Ô∏è Disson√¢ncias Menores:</h3>';
                outras.forEach(d => {
                    html += `
                        <div style="background: #fff3e0; padding: 15px; border-left: 4px solid #ff9800; 
                                    border-radius: 5px; margin-bottom: 15px;">
                            <p><strong>${d.tipo}</strong> (${d.par})</p>
                            <p>${d.descricao}</p>
                            <p style="color: #7f8c8d;"><em>${d.interpretacao}</em></p>
                        </div>
                    `;
                });
            }

            html += `
                <div style="margin-top: 30px; padding: 20px; background: #e3f2fd; border-radius: 8px;">
                    <strong>Total de disson√¢ncias:</strong> ${dissonancias.length}<br>
                    <strong>N√≠vel de consist√™ncia:</strong> ${
                        dissonancias.length === 0 ? 'Excelente (100%)' :
                        dissonancias.length <= 2 ? 'Bom (80%)' :
                        dissonancias.length <= 4 ? 'Moderado (60%)' :
                        'Baixo (< 50%)'
                    }
                </div>
            `;

            return html;
        }

        function renderizarRecomendacoes(recomendacoes) {
            let html = '';

            // Alertas cr√≠ticos
            if (recomendacoes.alertas.length > 0) {
                html += '<h3 style="color: #f44336;">üö® Alertas Cr√≠ticos:</h3>';
                recomendacoes.alertas.forEach(alerta => {
                    html += `
                        <div class="alert-critico">
                            <h4 style="color: #f44336; margin-top: 0;">N√≠vel: ${alerta.nivel}</h4>
                            <p><strong>${alerta.texto}</strong></p>
                            <p><strong>A√ß√µes Necess√°rias:</strong></p>
                            <ul>
                                ${alerta.acoes.map(acao => `<li>${acao}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                });
            }

            // Prioridade 1
            if (recomendacoes.prioridade1.length > 0) {
                html += '<h3 style="color: #f44336; margin-top: 30px;">üî¥ Prioridade 1 - URGENTE:</h3>';
                recomendacoes.prioridade1.forEach(rec => {
                    html += `
                        <div class="recomendacao-box" style="background: linear-gradient(135deg, #ffebee, #ffcdd2); 
                                                              border-left-color: #f44336;">
                            <h4 style="color: #f44336; margin-top: 0;">${rec.area}</h4>
                            <p><strong>Objetivo:</strong> ${rec.objetivo}</p>
                            <p><strong>Prazo:</strong> ${rec.prazo}</p>
                            <p><strong>A√ß√µes:</strong></p>
                            <ul>
                                ${rec.acoes.map(acao => `<li>${acao}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                });
            }

            // Prioridade 2
            if (recomendacoes.prioridade2.length > 0) {
                html += '<h3 style="color: #ff9800; margin-top: 30px;">üü° Prioridade 2 - IMPORTANTE:</h3>';
                recomendacoes.prioridade2.forEach(rec => {
                    html += `
                        <div class="recomendacao-box" style="background: linear-gradient(135deg, #fff3e0, #ffe0b2); 
                                                              border-left-color: #ff9800;">
                            <h4 style="color: #ff9800; margin-top: 0;">${rec.area}</h4>
                            <p><strong>Objetivo:</strong> ${rec.objetivo}</p>
                            <p><strong>Prazo:</strong> ${rec.prazo}</p>
                            <p><strong>A√ß√µes:</strong></p>
                            <ul>
                                ${rec.acoes.map(acao => `<li>${acao}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                });
            }

            // Prioridade 3
            if (recomendacoes.prioridade3.length > 0) {
                html += '<h3 style="color: #4caf50; margin-top: 30px;">üü¢ Prioridade 3 - DESEJ√ÅVEL:</h3>';
                recomendacoes.prioridade3.forEach(rec => {
                    html += `
                        <div class="recomendacao-box">
                            <h4 style="color: #4caf50; margin-top: 0;">${rec.area}</h4>
                            <p><strong>Objetivo:</strong> ${rec.objetivo}</p>
                            <p><strong>Prazo:</strong> ${rec.prazo}</p>
                            <p><strong>A√ß√µes:</strong></p>
                            <ul>
                                ${rec.acoes.map(acao => `<li>${acao}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                });
            }

            if (!html) {
                html = `
                    <div class="recomendacao-box">
                        <p>‚úÖ Nenhuma recomenda√ß√£o urgente identificada. Perfil saud√°vel e consistente.</p>
                        <p>Sugere-se acompanhamento peri√≥dico para manuten√ß√£o do bem-estar sexual.</p>
                    </div>
                `;
            }

            return html;
        }

        function getBadgeClass(perfil) {
            const map = {
                'Dominante': 'badge-dominante',
                'Submisso': 'badge-submisso',
                'Switch/Vers√°til': 'badge-switch',
                'Explorador': 'badge-explorador',
                'Rom√¢ntico': 'badge-romantico',
                'Conservador': 'badge-conservador'
            };
            return map[perfil] || 'badge-switch';
        }

        function formatarEstadoCivil(valor) {
            const map = {
                'solteira': 'Solteira',
                'namoro': 'Namoro/Relacionamento',
                'casada': 'Casada/Uni√£o Est√°vel',
                'divorciada': 'Divorciada/Separada',
                'viuva': 'Vi√∫va'
            };
            return map[valor] || valor;
        }

        function formatarLocalidade(valor) {
            const map = {
                'capital': 'Capital/Regi√£o Metropolitana',
                'media': 'Cidade M√©dia',
                'pequena': 'Cidade Pequena/Interior'
            };
            return map[valor] || valor;
        }

        function formatarEscolaridade(valor) {
            const map = {
                'fundamental': 'Ensino Fundamental',
                'medio': 'Ensino M√©dio',
                'superior_incompleto': 'Superior Incompleto',
                'superior': 'Superior Completo',
                'pos': 'P√≥s-gradua√ß√£o/Mestrado/Doutorado'
            };
            return map[valor] || valor;
        }
    </script>
</body>
</html>

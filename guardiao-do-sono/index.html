<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- iOS Specific Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="GuardiÃ£o do Sono">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Prevent iOS from pausing audio when screen locks -->
    <meta name="format-detection" content="telephone=no">
    
    <title>O GuardiÃ£o do Sono - ExperiÃªncia TerapÃªutica 3D</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/user-management.css">
</head>
<body>
    <!-- Tela de boas-vindas -->
    <div id="welcome-screen" class="screen active">
        <div class="welcome-content">
            <h1 class="title-glow">ğŸŒ™ O GuardiÃ£o do Sono</h1>
            <p class="subtitle">Uma jornada terapÃªutica de 10 minutos para relaxamento profundo</p>
            
            <div class="instructions">
                <h3>Prepare-se:</h3>
                <ul>
                    <li>ğŸ›ï¸ Deite-se confortavelmente</li>
                    <li>ğŸ§ Use fones de ouvido</li>
                    <li>ğŸŒ‘ Reduza a iluminaÃ§Ã£o do ambiente</li>
                    <li>ğŸ˜Œ Respire profundamente</li>
                </ul>
            </div>

            <!-- ğŸŒŸ NOVIDADES -->
            <div class="feature-card">
                <div class="feature-badge">âœ¨ NOVO</div>
                <h3 style="color: #f093fb; margin-bottom: 10px; font-size: 1.3rem;">ğŸŒ± Incubador de Sonhos</h3>
                <p style="opacity: 0.9; line-height: 1.5; margin-bottom: 15px;">
                    Plante uma intenÃ§Ã£o antes de dormir. Sua mente subconsciente trabalharÃ¡ nela enquanto vocÃª descansa.
                </p>
                <div class="feature-highlights">
                    <div class="highlight-item">ğŸ’­ Ancoragem NLP</div>
                    <div class="highlight-item">ğŸ¨ VisualizaÃ§Ã£o 3D</div>
                    <div class="highlight-item">ğŸ“– HistÃ³rico de sonhos</div>
                    <div class="highlight-item">ğŸ’ +3 Cristais bÃ´nus</div>
                </div>
                <p style="font-size: 0.85rem; opacity: 0.7; margin-top: 12px;">
                    â„¹ï¸ Acesse pelo painel lateral durante o jogo
                </p>
            </div>

            <!-- Status de Voz -->
            <div id="voice-status" style="margin: 20px 0; padding: 16px; background: rgba(76, 175, 80, 0.2); border-radius: 12px; border-left: 4px solid #4caf50;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 28px;">ğŸ¤</span>
                    <div>
                        <div style="font-weight: bold; color: #4caf50; font-size: 1.1em;">NarraÃ§Ã£o em PortuguÃªs do Brasil</div>
                        <div style="font-size: 0.9em; color: #aaa; margin-top: 4px;">
                            âœ… Ãudios prÃ©-gravados â€¢ Voz natural e terapÃªutica
                        </div>
                        <div style="font-size: 0.85em; color: #888; margin-top: 4px;">
                            ğŸ§ Use fones de ouvido para melhor experiÃªncia
                        </div>
                    </div>
                </div>
            </div>

            <button id="start-button" class="glow-button">
                ğŸŒ™ Iniciar Jornada ao Sono
            </button>

            <p class="disclaimer">
                âš ï¸ Este jogo Ã© um complemento relaxante e nÃ£o substitui tratamento mÃ©dico ou terapÃªutico.
            </p>
        </div>
    </div>

    <!-- Canvas 3D -->
    <canvas id="game-canvas"></canvas>

    <!-- ğŸŒŸ PAINEL PREMIUM: GuardiÃ£o da EvoluÃ§Ã£o -->
    <div id="evolution-panel" class="evolution-panel">
        <div class="panel-header">
            <h3>ğŸŒ™ Seu GuardiÃ£o</h3>
            <button id="toggle-panel" class="toggle-btn">â—€</button>
        </div>

        <!-- Avatar 3D Container -->
        <div id="avatar-container" class="avatar-container">
            <canvas id="avatar-canvas"></canvas>
        </div>

        <!-- NÃ­vel e Progresso -->
        <div class="progress-section">
            <div class="level-info">
                <span class="level-label">NÃ­vel</span>
                <span id="user-level" class="level-number">1</span>
                <span id="level-title" class="level-title">Iniciante</span>
            </div>
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
            </div>
            <div class="progress-text">
                <span id="sessions-count">0</span>/5 sessÃµes
            </div>
        </div>

        <!-- Conquistas -->
        <div class="achievements-section">
            <h4>ğŸ† Conquistas</h4>
            <div id="achievements-list" class="achievements-grid">
                <!-- Preenchido por JS -->
            </div>
        </div>

        <!-- ğŸŒ± INCUBADOR DE SONHOS (NOVO!) -->
        <div class="dream-incubator-section">
            <div class="incubator-header">
                <h4>ğŸŒ± Incubador de Sonhos</h4>
                <span class="incubator-badge">INÃ‰DITO</span>
            </div>
            
            <p class="incubator-description">
                Plante uma intenÃ§Ã£o antes de dormir. Sua mente subconsciente cuidarÃ¡ dela enquanto vocÃª descansa.
            </p>
            
            <!-- Input de IntenÃ§Ã£o -->
            <div class="dream-input-container">
                <textarea 
                    id="dream-intention" 
                    class="dream-input" 
                    placeholder="Quero sonhar com..."
                    maxlength="200"
                    rows="3"
                ></textarea>
                <div class="char-counter">
                    <span id="char-count">0</span>/200
                </div>
            </div>
            
            <!-- BotÃ£o de Plantar -->
            <button id="plant-dream-btn" class="plant-button" disabled>
                ğŸŒ± Plantar Semente do Sonho
            </button>
            
            <!-- Semente Ativa -->
            <div id="active-seed" class="active-seed" style="display: none;">
                <div class="seed-visual">
                    <canvas id="seed-canvas" width="280" height="120"></canvas>
                </div>
                <div class="seed-info">
                    <div class="seed-label">ğŸŒ± Semente Ativa:</div>
                    <div id="seed-text" class="seed-text"></div>
                    <div class="seed-progress">
                        <div class="seed-growth-bar">
                            <div id="seed-growth-fill" class="seed-growth-fill"></div>
                        </div>
                        <div class="seed-status">
                            <span id="seed-age">Plantada hÃ¡ 0 min</span>
                        </div>
                    </div>
                </div>
                <button id="harvest-dream-btn" class="harvest-button">
                    âœ¨ Colher Sonho
                </button>
            </div>
            
            <!-- HistÃ³rico de Sonhos -->
            <div class="dream-history">
                <button id="toggle-history" class="toggle-history-btn">
                    ğŸ“– Ver HistÃ³rico (<span id="history-count">0</span> sonhos)
                </button>
                <div id="history-list" class="history-list" style="display: none;">
                    <!-- Preenchido por JS -->
                </div>
            </div>
        </div>

        <!-- Cristais de Energia -->
        <div class="crystals-section">
            <div class="crystals-display">
                <span class="crystal-icon">ğŸ’</span>
                <span id="crystal-count" class="crystal-count">0</span>
                <span class="crystal-label">Cristais</span>
            </div>
        </div>

        <!-- BenefÃ­cios Premium -->
        <div class="premium-benefits">
            <div class="benefit-item locked" id="benefit-narrations">
                <span class="benefit-icon">ğŸ™ï¸</span>
                <div class="benefit-info">
                    <div class="benefit-name">NarraÃ§Ãµes Extras</div>
                    <div class="benefit-requirement">NÃ­vel 3 â€¢ 15 ğŸ’</div>
                </div>
            </div>
            <div class="benefit-item locked" id="benefit-phase">
                <span class="benefit-icon">ğŸŒŒ</span>
                <div class="benefit-info">
                    <div class="benefit-name">Fase Secreta</div>
                    <div class="benefit-requirement">NÃ­vel 5 â€¢ 30 ğŸ’</div>
                </div>
            </div>
        </div>
    </div>

    <!-- HUD overlay -->
    <div id="hud-overlay">
        <div id="phase-indicator" class="fade-text"></div>
        <div id="narration-text" class="narration"></div>
        <div id="breath-indicator" class="breath-circle"></div>
    </div>

    <!-- Tela de finalizaÃ§Ã£o -->
    <div id="end-screen" class="screen">
        <div class="end-content">
            <h2 class="title-glow">âœ¨ Agora, seu corpo sabe o caminho do descanso.</h2>
            <p class="subtitle">Permita-se adormecer tranquilamente...</p>
            
            <div class="sleep-timer">
                <p>O som continuarÃ¡ por mais alguns minutos para facilitar sua transiÃ§Ã£o para o sono.</p>
            </div>

            <button id="restart-button" class="glow-button">
                Reiniciar ExperiÃªncia
            </button>
        </div>
    </div>

    <!-- Loading indicator -->
    <div id="loading-screen" class="screen">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>Preparando sua jornada...</p>
        </div>
    </div>

    <!-- Tela de configuraÃ§Ã£o removida - Agora usa Ã¡udios prÃ©-gravados -->

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Scripts do jogo -->
    <script src="js/user-management.js"></script>
    <script src="js/session-tracker.js"></script>
    <script src="js/wake-lock.js"></script>
    <script src="js/voice-system.js"></script>
    <script src="js/audio-system.js"></script>
    <script src="js/binaural-beats.js"></script>
    <script src="js/phase-transition.js"></script>
    <script src="js/phase-1-sunset.js"></script>
    <script src="js/phase-2-underwater.js"></script>
    <script src="js/phase-3-guardian.js"></script>
    <script src="js/evolution-system.js"></script>
    <script src="js/avatar-3d.js"></script>
    <script src="js/dream-incubator.js"></script>
    <script src="js/main.js"></script>
    <script src="js/voice-ui.js"></script>
</body>
</html>
